---
title: "Projekt"
date: "20 nov 2019"
output: html_document
---

## Intoduction

In this project, we are focusing on dealing with image classification, which refers to a process in computer vision that can classify an image according to its visual content. Over the last years, it has grown effective due to it using deep learning. Deep learning is a class of machine learning that uses multiple layers to extract higher level features. Some expamples on its usage are Face Recognition on social platforms like Facebook or Product Discoverability which allows consumers to search for similar images or products.  

In this project we're making a guide on image classification in R. We're working with the Fruit data set from Kaggle, found on https://www.kaggle.com/moltean/fruits/data. Here 120 different fruits and vegetables are stored in different classes. The data set has 82213 images of fruit and vegetables. The data set is split into a training set containing 61488 images and a test set containing 20622 images. The images sizes are 100x100 pixels. 

In the data set there was a difference in lighting conditions, the background was not uniform and beforehand there has been written a dedicated algorithm which extracts the fruit from the background, so the fruit and vegetables are seen on the images with a white background.

## Load the data
We start by cleaning the global environment. 

```{r}
#Cleaning the environment
rm(list=ls())
```

And then we'll import Keras, which is essential for the anaysis. You have to use "install_keras" if you're installing Keras for the first time.

```{r}
devtools::install_github("rstudio/keras")
library(keras)
#install_keras()
```

And then we'll load a bunch of other packages.

```{r, include=FALSE}
#Loading packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, 
               magrittr,
               tidytext,
               tm,
               readr,
               topicmodels,
               rsample,
               glmnet,
               SnowballC
               )
```


## Preprocessing 

And then we can load the data... bla bla bla. local or Github.

```{r}
train_images = "/Users/Emma/OneDrive/Universitetet/9. semester/SDS/M3/fruits-360_dataset/fruits-360/Training/"

test_images = "/Users/Emma/OneDrive/Universitetet/9. semester/SDS/M3/fruits-360_dataset/fruits-360/Test/"
```

```{r}
#train_images = "C:/Users/Michael Thomsen/Desktop/fruits-360_dataset/fruits-360/Training/"

#test_images = "C:/Users/Michael Thomsen/Desktop/fruits-360_dataset/fruits-360/Test/"
```


Then we need to define a vector of the fruits and vegetables we want to train our model to classify, as we're not going to train it to classify 120.

```{r}
list = c("Kiwi", "Banana", "Apricot", "Avocado", "Cocos", "Clementine", "Mandarine", "Orange", "Limes", "Lemon", "Peach", "Plum", "Raspberry", "Strawberry", "Pineapple", "Pomegranate")
```

Then we're using the function "image_data_generator", which can load and generate batches of the image data. Here we're first rescaling the image data. For most image data, the pixel values are integers with values between 0 and 255, which is why dividing the data with 255. This is performed across all channels, regardless of the actual range of pixel values that are present in the images. Here we're also applying zoom range, which is the amount of zoom. We're also rescaling the test data set

```{r}
train_data_gen <- image_data_generator(rescale = 1/255)
test_data_gen <- image_data_generator(rescale = 1/255)
```

We now want to load our images into the memory and resize them. To do this the 'flow_images_from_directory' function from the Keras package will come in use. It allows us to generate batches of data from images in a directory. We start by setting the 'class_mode' to categorical, due to the data list we created earlier. The same applies for the which 'classes', we are refering back to. At last we the set the seed to 123, as it allows us to reproduce the same results later.

```{r}
#Training images
training_set <- flow_images_from_directory(train_images,
                                          train_data_gen,
                                          class_mode = "categorical", 
                                          classes = list,
                                          seed = 123)

#Testing images
test_set <- flow_images_from_directory(test_images,
                                          test_data_gen,
                                          class_mode = "categorical", 
                                          classes = list,
                                          seed = 123)
```



```{r}
cat("Number of images per class:")
table(factor(training_set$classes))
```

